
OrganizationUpdate:
  Type: update-organization
  Template: ./organization.yml

OrganizationFormationBuildRole:
  Type: update-stacks
  Template: ./build-role.yml
  StackName: org-formation-build-role
  TerminationProtection: true
  DefaultOrganizationBindingRegion: eu-west-1
  DefaultOrganizationBinding:
    IncludeMasterAccount: false # OrganizationFormationBuildRole must have been manually added to the build account in order to bootstrap
    ExcludeAccount: !Ref OrganizationBuildAccount
    Account: '*'
  Parameters:
    buildAccountId: !Ref OrganizationBuildAccount
  TaskRoleName: 'OrganizationAccountAccessRole'
  TaskViaRoleArn: !Sub 'arn:aws:iam::${MasterAccount}:role/OrganizationFormationBuildRole'

BucketToAllAccounts:
  Type: update-stacks
  DependsOn: OrganizationFormationBuildRole
  Template: ./bucket.yml
  StackName: bucket
  DefaultOrganizationBindingRegion: eu-west-1
  DefaultOrganizationBinding:
    IncludeMasterAccount: true
    Account: '*'

